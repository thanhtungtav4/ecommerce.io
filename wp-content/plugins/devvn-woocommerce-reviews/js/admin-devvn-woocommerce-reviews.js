!function(e){"use strict";e(document).ready(function(){var t=e("#admin_devvn_reviews_nonce").val(),n=!1;e("body").on("click",".sync_old_reviews",function(){var a=e(this).closest("tr"),s=e(".mess",a);return n||e.ajax({type:"post",dataType:"json",url:devvn_reviews.ajax_url,data:{action:"devvn_reviews_sync_cmt",nonce:t},context:this,beforeSend:function(){s.html("Đang chạy..."),n=!0},success:function(e){e.success?s.css("color","green").html(e.data):s.css("color","red").html(e.data),n=!1},error:function(e,t,a){s.css("color","red").html("C\xf3 lỗi xảy ra!"),n=!1}}),!1});var a=!1;e("body").on("click",".fake_reviews_bought",function(){var n=e(this).closest("tr"),s=e(".mess",n);return a||e.ajax({type:"post",dataType:"json",url:devvn_reviews.ajax_url,data:{action:"fake_reviews_bought",nonce:t},context:this,beforeSend:function(){s.html("Đang chạy..."),a=!0},success:function(e){e.success?s.css("color","green").html(e.data):s.css("color","red").html(e.data),a=!1},error:function(e,t,n){s.css("color","red").html("C\xf3 lỗi xảy ra!"),a=!1}}),!1}),e("body").on("click",".admin_fake_label",function(){var t=e(this).data("id"),n=e(this).data("nonce");return a||e.ajax({type:"post",dataType:"json",url:devvn_reviews.ajax_url,data:{action:"admin_fake_label",id:t,nonce:n},context:this,beforeSend:function(){e(this).text(devvn_reviews.text_loading),a=!0},success:function(t){t.success?(e(this).after(devvn_reviews.text_done),e(this).remove()):e(this).text(devvn_reviews.text_error),a=!1},error:function(t,n,s){e(this).text(devvn_reviews.text_error),a=!1}}),!1}),e("body").on("change","#review_position_select",function(){"custom"==e(this).val()?e(".review_position_action").addClass("active"):e(".review_position_action").removeClass("active")});var s=!1;e("body").on("click",".open_comment_prod",function(){var n=e(this).closest("tr"),a=e(".mess",n);return s||e.ajax({type:"post",dataType:"json",url:devvn_reviews.ajax_url,data:{action:"open_comment_prod",nonce:t},context:this,beforeSend:function(){a.html("Đang chạy..."),s=!0},success:function(e){e.success?a.css("color","green").html(e.data):a.css("color","red").html(e.data),s=!1},error:function(e,t,n){a.css("color","red").html("C\xf3 lỗi xảy ra!"),s=!1}}),!1});var o=!1;e("body").on("click",".reviews_active_license",function(){var t=e("#reviews_license").val(),n=e(this).data("nonce"),a=e(this).closest("td");return t&&!o&&e.ajax({type:"post",dataType:"json",url:devvn_reviews.ajax_url,data:{action:"active_license_reviews",license:t,nonce:n},context:this,beforeSend:function(){o=!0,e(".spinner",a).css({visibility:"visible"})},success:function(t){t.success?(alert(t.data),location.reload()):alert(t.data),o=!1,e(".spinner",a).css({visibility:"hidden"})},error:function(t,n,s){alert(n),o=!1,e(".spinner",a).css({visibility:"hidden"})}}),!1});var c=1,i=0,r=0;e("body").on("click",".fake_sold_prod",function(){return!0==confirm("Bạn c\xf3 chắc chắn kh\xf4ng? Khi đang Fake th\xec kh\xf4ng được tắt cửa sổ n\xe0y cho tới khi xong hoặc b\xe1o lỗi nh\xe9!")&&(function n(s){let o=e(".mess",s.closest("tr")),r=s.data("type"),l=parseInt(e("#fake_sold_from").val())||0,d=parseInt(e("#fake_sold_to").val())||0,u=parseInt(e("#fake_per_page").val())||20;a||e.ajax({type:"post",dataType:"json",url:devvn_reviews.ajax_url,data:{action:"fake_sold_prod",sold_type:r,sold_form:l,sold_to:d,fake_per_page:u,fake_paged:c,nonce:t},context:this,beforeSend:function(){0==i&&o.html("Đang chạy..."),a=!0},success:function(e){if(e.success){let t=e.data.complete;if(i+=parseInt(e.data.number),t){let r="Đ\xe3 fake xong. Tất cả c\xf3 "+i+" sản phẩm đ\xe3 được fake số lượng đ\xe3 b\xe1n.";o.css("color","green").html(r),alert(r),c=1,i=0}else o.css("color","green").html("Đ\xe3 fake "+i+" sản phẩm. Đang chạy..."),a=!1,c++,n(s)}else o.css("color","red").html(e.data),alert(e.data),c=1,i=0;a=!1},error:function(e,t,n){o.css("color","red").html("C\xf3 lỗi xảy ra! "+t),a=!1}})}(e(this)),!1)});var l=!1;function d(){let t=parseInt(e("#auto_reviews_number_reviews").val())||0,n=parseInt(e("#auto_reviews_number_reviews_to").val())||0;t>n&&e("#auto_reviews_number_reviews_to").val(t)}if(e("body").on("click",".reset_sold",function(){if(!0!=confirm("Bạn c\xf3 chắc chắn muốn reset số lượng đ\xe3 b\xe1n kh\xf4ng?"))return!1;var n=e(this).closest("tr"),a=e(".mess",n);return s||e.ajax({type:"post",dataType:"json",url:devvn_reviews.ajax_url,data:{action:"reset_sold",nonce:t},context:this,beforeSend:function(){a.html("Đang chạy..."),l=!0},success:function(e){e.success?a.css("color","green").html(e.data):a.css("color","red").html(e.data),l=!1},error:function(e,t,n){a.css("color","red").html("C\xf3 lỗi xảy ra!"),l=!1}}),!1}),e("body").on("click",".devvn_gm_addimages",function(t){t.preventDefault();var n,a=e(this),s=a.closest(".devvn_gm_wrap"),o=s.find("#attachment_img"),c=s.find("ul.devvn_gm_images");if(n){n.open();return}(n=wp.media.frames.product_gallery=wp.media({title:a.data("choose"),button:{text:a.data("update")},states:[new wp.media.controller.Library({title:a.data("choose"),filterable:"all",multiple:!0})]})).on("select",function(){var e=n.state().get("selection"),t=o.val();e.map(function(e){if((e=e.toJSON()).id){t=t?t+","+e.id:e.id;var n=e.sizes&&e.sizes.thumbnail?e.sizes.thumbnail.url:e.url;e.filename&&e.filename,c.append('<li class="image" data-attachment_id="'+e.id+'"><div class="li_img_box"><img src="'+n+'" /><ul class="actions"><li><a href="#" class="gm_delete" title="'+a.data("delete")+'"><span class="dashicons dashicons-no-alt"></span></a></li></ul></div></li>')}}),o.val(t)}),n.open()}),e("body").on("click",".devvn_gm_images a.gm_delete",function(){var t=e(this).closest(".devvn_gm_wrap"),n=t.find("#attachment_img");e(this).closest("li.image").remove();var a="";return t.find("ul li.image").each(function(){var e=jQuery(this).attr("data-attachment_id");a=a?a+","+e:e}),n.val(a),!1}),e("body").on("click",".go_auto_reviews",function(){if(!0==confirm("Bạn đ\xe3 lưu c\xe0i đặt chưa? Nếu chưa th\xec ấn cancel. Nếu đ\xe3 lưu th\xec ấn okie để tiếp tục")&&!0==confirm("Bạn c\xf3 chắc chắn muốn đ\xe1nh gi\xe1 tự động cho tất cả sản phẩm kh\xf4ng?"))return function n(s){var o=e(s).closest("tr"),l=e(".mess",o);let d=parseInt(e("#auto_per_page").val())||20;a||e.ajax({type:"post",dataType:"json",url:devvn_reviews.ajax_url,data:{action:"autoreviews_prod",auto_per_page:d,fake_paged:c,nonce:t},context:this,beforeSend:function(){0==i&&l.html("Đang chạy..."),a=!0},success:function(e){if(e.success){let t=e.data.complete,o=parseInt(e.data.number),d=parseInt(e.data.rv_count);if(i+=o,r+=d,t){let u="Đ\xe3 đ\xe1nh gi\xe1 xong. Tất cả c\xf3 "+r+" đ\xe1nh gi\xe1 /"+i+" sản phẩm đ\xe3 được đ\xe1nh gi\xe1.";l.css("color","green").html(u),alert(u),c=1,i=0,r=0}else l.css("color","green").html("Đ\xe3 c\xf3 "+r+" đ\xe1nh gi\xe1 /"+i+" sản phẩm. Đang chạy..."),a=!1,c++,n(s)}else l.css("color","red").html(e.data),alert(e.data),c=1,i=0,r=0;a=!1},error:function(e,t,n){l.css("color","red").html("C\xf3 lỗi xảy ra! "+t),a=!1}})}(e(this)),!1}),d(),e("#auto_reviews_number_reviews, #auto_reviews_number_reviews_to").on("change",function(){d()}),void 0!==e.fn.datepicker&&e("#date_reviews_form").length>0){var u=e("#date_reviews_form"),h=e("#date_reviews_to");e("#date_reviews_form, #date_reviews_to").datepicker({dateFormat:"yy-mm-dd"}),u.on("change",function(){h.datepicker("option","minDate",u.val())}),h.on("change",function(){u.datepicker("option","maxDate",h.val())})}e("#cat_reviews").length>0&&e("#cat_reviews").select2({allowClear:!0,multiple:!0,placeholder:"Chọn danh mục sản phẩm"}),e("#prod_reviews").length>0&&e("#prod_reviews").select2({ajax:{url:devvn_reviews.ajax_url,dataType:"json",delay:250,data:function(e){return{term:e.term,action:"woocommerce_json_search_products",security:devvn_reviews.nonce}},processResults:function(t,n){let a=[];return t&&e.each(t,function(e,t){a.push({id:e,text:t})}),{results:a}},cache:!0},placeholder:"T\xecm kiếm sản phẩm",minimumInputLength:3,language:"vi"})})}(jQuery);