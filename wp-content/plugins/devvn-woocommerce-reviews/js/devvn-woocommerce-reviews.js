!function(e,t){"use strict";e(document).ready(function(){function n(){var t=devvn_reviews.star_1,n=devvn_reviews.star_2,a=devvn_reviews.star_3,i=devvn_reviews.star_4,r=devvn_reviews.star_5;e("body p.stars a").each(function(o){switch(o){case 0:e(this).html(t);break;case 1:e(this).html(n);break;case 2:e(this).html(a);break;case 3:e(this).html(i);break;case 4:e(this).html(r)}}),e("body").on("click","#respond p.stars a",function(){var o=e(this),s=e(this).closest("#respond").find("#rating");switch(e(this).closest(".stars"),o.text()){case t:s.val(1);break;case n:s.val(2);break;case a:s.val(3);break;case i:s.val(4);break;case r:s.val(5)}}),e("body p.stars a.star-5").trigger("click")}n(),e("body").on("init",function(){n()}),e(window).on("load",function(){setTimeout(function(){n()},1e3)});var a=parseInt(devvn_reviews.number_img_upload),i=e(".devvn_attach_view"),r=e(".list_attach");function o(){var t=e("#countContent"),n=e("#comment").val();if(0==(n=e.trim(n)).length){t.text("0 "+devvn_reviews.minlength_text2);return}n.split(/\W/),t.text(n.length+" "+devvn_reviews.minlength_text2)}function s(){e(".devvn_attach_view li").length<=a-1&&e(".devvn_attach_view li").length>0?r.addClass("show-btn"):r.removeClass("show-btn")}e("body").on("keyup","#comment",function(){o()}),o(),e.validator.addMethod("vietnamphone",function(e,t){return!devvn_reviews.vietnamphone||/^0+(\d{9,10})$/.test(e)},"H\xe3y điền đ\xfang số điện thoại"),e.validator.addMethod("customemail",function(e,t){return""==e||/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)},"Định dạng email kh\xf4ng đ\xfang."),e("#commentform").validate({invalidHandler:function(t,n){n.numberOfInvalids()?e("div.error").show():e("div.error").hide()},rules:{author:{required:!0,minlength:2},phone:{required:{depends:function(){return e(this).val(e.trim(e(this).val())),!0}},vietnamphone:!0,minlength:2},email:{customemail:!0},comment:{required:function(t){return!(e('input[name="quick_tag[]"]:checked').length>0)},minlength:devvn_reviews.cmt_length}},messages:{author:devvn_reviews.name_required_text,email:devvn_reviews.email_required_text,phone:devvn_reviews.phone_required_text,comment:{required:devvn_reviews.cmt_required_text,minlength:devvn_reviews.minlength_text}},errorElement:"div",errorPlacement:function(e,t){t.after(e)},submitHandler:function(t){var n=e(t).attr("action");return e.ajax({url:n,type:"POST",data:new FormData(t),processData:!1,contentType:!1,beforeSend:function(){e("#review_form_wrapper, #respond").addClass("devvn_loading")},success:function(n,a){let i=new DOMParser().parseFromString(n,"text/html"),r=e(i).find(".wp-die-message").text();if(r)return alert(r),e("#review_form_wrapper, #respond").removeClass("devvn_loading"),e("body li.review #respond #cancel-comment-reply-link").trigger("click"),!1;e("#review_form_wrapper, #respond").removeClass("devvn_loading"),alert(devvn_reviews.review_success),e("#comment",t).val(""),e(".devvn_attach_view",t).html(""),e("body li.review #respond #cancel-comment-reply-link").trigger("click"),e.magnificPopup.close()},error:function(t,n,a){alert(e(new DOMParser().parseFromString(t.responseText,"text/html")).find(".wp-die-message").text()),e("#review_form_wrapper, #respond").removeClass("devvn_loading"),e("body li.review #respond #cancel-comment-reply-link").trigger("click")}}),!1}}),e("body").on("click",".btn-reviews-now",function(){if(e("ol.commentlist .comment-respond").length<=0)e.magnificPopup.open({items:{src:"#review_form_wrapper",type:"inline"},showCloseBtn:!1,closeOnBgClick:!1,modal:!0,mainClass:"devvn-reviews-popup"});else{var t=e(".commentlist #respond").offset().top;e("html, body").animate({scrollTop:t-44},500)}}),e(document).on("click",".fancybox-close-small",function(t){t.preventDefault(),e.magnificPopup.close()}),e("body").on("click",".devvn_insert_attach",function(){if(e(this).closest("#commentform"),!1==((e(".devvn_attach_view li").each(function(){e("input",this).val()?e(this).removeClass("li_file_hide"):e(this).remove()}),e(".devvn_attach_view li").length>=a)?(r.removeClass("show-btn"),!1):(r.addClass("show-btn"),!0)))alert(devvn_reviews.file_length_text);else{var t=e.now();i.append('<li id="li_files_'+t+'" class="li_file_hide"><div class="img-wrap"><span class="close">&times;</span><div class="img-wrap-box"></div></div><div class="'+t+'"><input type="file" name="attach[]" id="files_'+t+'" accept="image/jpeg, image/png, image/gif, image/x-png"></div></li>'),s(),e("#files_"+t).trigger("click")}return!1}),e("body").on("click",".img-wrap .close",function(){e(this).closest("li").remove(),s()}),e("body").on("change",'[name="attach[]"]',function t(n){if(n.target.files){var a=n.target.files[0],i=e(this);if(a){var r,o=new FileReader;o.onload=(r=a,function(t){var n,a,o,c,l,d,m,v,u;if(!1==(v=(a=r).type,"image/jpeg"==v||"image/png"==v||"image/x-png"==v||"image/gif"==v)?(alert(devvn_reviews.file_format_text),1):!1==(u=a.size,u<devvn_reviews.img_size)?(alert(devvn_reviews.file_size_text),1):0)i.closest("li").remove();else o=t,c=r,d=(l=i).closest("li"),m='<img class="thumb" src="'+o.target.result+'" title="'+encodeURI(c.name)+'" data-id="'+c.name+'"/>',e(".img-wrap-box",d).html(m),d.removeClass("li_file_hide"),s();s()}),o.readAsDataURL(a)}}}),e("body").on("init",function(){e("#commentform").length>0&&(e("#commentform")[0].encoding="multipart/form-data")});var c=!1;function l(){e(".cmt_attachment_img").each(function(){e(this).magnificPopup({delegate:"a",type:"image",mainClass:"devvn-reviews-popup mfp-img-mobile",gallery:{enabled:!0,navigateByImgClick:!0,preload:0}})})}e("body").on("init",function(){var n=e("#devvn_cmt"),a=e(".devvn_prod_cmt");n.validate({onclick:!1,onkeyup:!1,onfocusout:!1,rules:{devvn_cmt_name:{required:!0,minlength:2},devvn_cmt_phone:{required:!0,minlength:8},devvn_cmt_email:{customemail:!0},devvn_cmt_content:{required:!0,minlength:devvn_reviews.cmt_length}},messages:{devvn_cmt_name:devvn_reviews.name_required_text,devvn_cmt_email:devvn_reviews.email_required_text,devvn_cmt_phone:devvn_reviews.phone_required_text,devvn_cmt_content:{required:devvn_reviews.cmt_required_text,minlength:devvn_reviews.minlength_text}},errorPlacement:function(e,t){alert(e.text())},submitHandler:function(t){if(!c){var n=e(t).serialize(),i=e("#devvn_cmt_content",t).val(),r=e('input[name="devvn_cmt_gender"]',t).val(),o=e("#devvn_cmt_name",t).val(),s=e("#devvn_cmt_phone",t).val(),l=e("#devvn_cmt_email",t).val();return e.ajax({type:"post",dataType:"json",url:devvn_reviews.ajax_url,data:{action:"devvn_cmt_submit",cmt_data:n,content:i,gender:r,name:o,email:l,phone:s},context:this,beforeSend:function(){c=!0,a.addClass("devvn_loading")},success:function(n){n.success?(n.data.result&&n.data.fragments&&e.each(n.data.fragments,function(t,n){e(t).html(n)}),alert(n.data.messages),e("#devvn_cmt_content",t).val(""),e("#devvn_cmt_search",a).val("")):alert(n.data),c=!1,a.removeClass("devvn_loading")},error:function(e,t,n){alert(e.responseText),c=!1,a.removeClass("devvn_loading")}}),!1}}});var i=t.template("reply-devvn-cmt");e("body").on("click",".devvn_cmt_reply",function(){e(".devvn_cmt_list_box #devvn_cmt_reply").remove();var t=e(this).closest("li"),n=e(this).attr("data-cmtid"),r="@"+e(this).attr("data-authorname")+": ";e(".devvn_cmt_child",t).length>0?e(".devvn_cmt_child li:nth-child(1)",t).prepend(i({parent_id:n,authorname:r})):t.append(i({parent_id:n,authorname:r}));var o=e(".devvn_cmt_list_box #devvn_cmt_reply #devvn_cmt_replycontent"),s=o.val();return o.val("").focus().val(s),e(".devvn_cmt_list_box #devvn_cmt_reply").validate({onclick:!1,onkeyup:!1,onfocusout:!1,rules:{devvn_cmt_replyname:{required:!0,minlength:2},devvn_cmt_replyphone:{required:!0},devvn_cmt_replyemail:{customemail:!0},devvn_cmt_replycontent:{required:!0,minlength:devvn_reviews.cmt_length}},messages:{devvn_cmt_replyname:devvn_reviews.name_required_text,devvn_cmt_replyphone:devvn_reviews.phone_required_text,devvn_cmt_replyemail:devvn_reviews.email_required_text,devvn_cmt_replycontent:{required:devvn_reviews.cmt_required_text,minlength:devvn_reviews.minlength_text}},errorPlacement:function(e,t){alert(e.text())},submitHandler:function(t){if(!c){var n=e(t).serialize(),i=e("#devvn_cmt_replycontent",t).val(),r=e('input[name="devvn_cmt_replygender"]',t).val(),o=e("#devvn_cmt_replyname",t).val(),s=e("#devvn_cmt_replyphone",t).val(),l=e("#devvn_cmt_replyemail",t).val();return e.ajax({type:"post",dataType:"json",url:devvn_reviews.ajax_url,data:{action:"devvn_cmt_submit",cmt_data:n,content:i,gender:r,name:o,phone:s,email:l},context:this,beforeSend:function(){c=!0,a.addClass("devvn_loading")},success:function(n){n.success?(n.data.result&&n.data.fragments&&e.each(n.data.fragments,function(t,n){e(t).html(n)}),alert(n.data.messages),e("#devvn_cmt_content",t).val(""),e("#devvn_cmt_search",a).val("")):alert(n.data),e(".devvn_cmt_list_box #devvn_cmt_reply").remove(),c=!1,a.removeClass("devvn_loading")},error:function(e,t,n){alert(e.responseText),c=!1,a.removeClass("devvn_loading")}}),!1}}}),!1}),e("body").on("click",".devvn_cancel_cmt",function(){e(this).closest("#devvn_cmt_reply").remove()}),e("body").on("submit","#devvn_cmt_search_form",function(){var t=e("#devvn_cmt_search",this).val(),n=e(this).serialize();return c||e.ajax({type:"post",dataType:"json",url:devvn_reviews.ajax_url,data:{action:"devvn_cmt_search",search:t,formData:n},context:this,beforeSend:function(){c=!0,a.addClass("devvn_loading")},success:function(t){t.success?t.data.result&&t.data.fragments&&e.each(t.data.fragments,function(t,n){e(t).html(n)}):alert(t.data),c=!1,a.removeClass("devvn_loading")},error:function(e,t,n){alert(e.responseText),c=!1,a.removeClass("devvn_loading")}}),!1}),e("body").on("click",".devvn_cmt_paged a",function(){var t=e(this).attr("href"),n=parseInt(t.replace("#tcomment-page=","")),i=e("#devvn_cmt_search",a).val(),r=e("#devvn_cmt_search_form",a).serialize();return c||e.ajax({type:"post",dataType:"json",url:devvn_reviews.ajax_url,data:{action:"devvn_cmt_load_paged",search:i,formData:r,paged:n},context:this,beforeSend:function(){c=!0,a.addClass("devvn_loading")},success:function(t){t.success?t.data.result&&t.data.fragments&&e.each(t.data.fragments,function(t,n){e(t).html(n)}):alert(t.data),c=!1,a.removeClass("devvn_loading")},error:function(e,t,n){alert(e.responseText),c=!1,a.removeClass("devvn_loading")}}),!1})}),e("body").on("init",function(){l()});var d=!1;e("body").on("click",".cmtlike",function(t){if(t.preventDefault(),!d&&!e(this).hasClass("liked")){var n=parseInt(e(this).data("id")),a=parseInt(e(this).data("like"))||0,i=e(".cmt_count",this);e.ajax({type:"post",dataType:"json",url:devvn_reviews.ajax_url,data:{action:"devvn_like_cmt",id:n},context:this,beforeSend:function(){d=!0,i.html(a+1)},success:function(t){t.success?e(this).addClass("liked"):i.html(a),d=!1},error:function(e,t,n){d=!1,i.html(a)}})}}),e("body.single-product").on("click","div#reviews ul.page-numbers li a",function(t){t.preventDefault();let n=e(this).attr("href"),a=e(this).closest("#reviews"),i=e(".commentlist",a),r=e(".woocommerce-pagination",a);a.addClass("devvn_loading"),n&&e.post(n,function(t){let n=e(t).find("div#reviews .commentlist").html(),a=e(t).find("div#reviews .woocommerce-pagination").html(),o=e(".single-product #reviews #comments").offset().top;e("html, body").animate({scrollTop:o},500),i.html(n),r.html(a),e(".commentlist .lazy-load").each(function(){let t=e(this).attr("data-src");t&&e(this).attr("src",t)}),e(document).trigger("devvn_reviews_loaded")}).done(function(){a.removeClass("devvn_loading"),l()}).fail(function(){alert("C\xf3 lỗi xảy ra")})})})}(jQuery,wp);